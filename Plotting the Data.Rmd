---
title: "Plotting the Data"
output: html_document
date: "2024-12-30"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Library Loading
```{r}
library(ggprism)
library(ggplot2)
library(viridis)
library(ggpubr)
library(tidyr)
library(dplyr)
library(emmeans)
```

## Looking at the Shared Factors

### Making Long Form
```{r}
DMSOdseLONG <- DMSOdsewithrep %>% pivot_longer(cols = c("Mean_Green_Norm", "Mean_Red_Norm", "Mean_Orange_Norm"), names_to = "Channel", values_to = "Expression")
```


### LNDN
```{r}
 DMSOdseLONG %>% filter(Abb_ECM %in% c("LNDN", "C1")) %>% ggplot(aes(x = Abb_ECM, y = Expression))+
  facet_grid(cols = vars(Channel))+
  geom_boxplot()+
  stat_compare_means(comparisons = list(c("LNDN", "C1")), label = "p.signif")+
  theme_prism()
```

### 25 x DNFN
```{r}
 DMSOdseLONG %>% filter(Abb_ECM %in% c("DNFN", "C1")) %>% ggplot(aes(x = Metadata_Stiffness, y = Expression, color = Abb_ECM))+
  facet_grid(cols = vars(Channel))+
  geom_boxplot()+
 # stat_compare_means(comparisons = list(c("1kPa", "25kPa")), label = "p.signif")+
  #stat_compare_means(comparisons = list(c("DNFN", "C1")), label = "p.signif")+
  stat_compare_means(aes(group = Abb_ECM), label = "p.signif")+
  theme_prism()

interaction.plot(x.factor = subset(DMSOdsewithrep, Abb_ECM %in% c("DNFN", "C1"))$Metadata_Stiffness, trace.factor = subset(DMSOdsewithrep, Abb_ECM %in% c("DNFN", "C1"))$Abb_ECM, resp = subset(DMSOdsewithrep, Abb_ECM %in% c("DNFN", "C1"))$Mean_Green_Norm, xlab = "Stiffness (kPa)", ylab = "PXR Expression", trace.label = "ECMs")

interaction.plot(x.factor = subset(DMSOdsewithrep, Abb_ECM %in% c("DNFN", "C1"))$Metadata_Stiffness, trace.factor = subset(DMSOdsewithrep, Abb_ECM %in% c("DNFN", "C1"))$Abb_ECM, resp = subset(DMSOdsewithrep, Abb_ECM %in% c("DNFN", "C1"))$Mean_Orange_Norm, xlab = "Stiffness (kPa)", ylab = "Vimentin Expression", trace.label = "ECMs")

interaction.plot(x.factor = subset(DMSOdsewithrep, Abb_ECM %in% c("DNFN", "C1"))$Metadata_Stiffness, trace.factor = subset(DMSOdsewithrep, Abb_ECM %in% c("DNFN", "C1"))$Abb_ECM, resp = subset(DMSOdsewithrep, Abb_ECM %in% c("DNFN", "C1"))$Mean_Red_Norm, xlab = "Stiffness (kPa)", ylab = "Ecad Expression", trace.label = "ECMs")

```

## Estimated Marginal Means (EMMeans) (Post-Hoc Testing)
```{r}
grid <- ref_grid(vimmodel, at = list(Metadata_Stiffness = levels("Metadata_Stiffness"), Abb_ECM = levels("Abb_ECM")), rg.limit = 10000)

EMStiffAbb <- lsmeans(vimmodel, ~ Metadata_Stiffness*Abb_ECM, ref_grid = grid)
pairs(EMStiffAbb)
```

```{r}
#install.packages("ggeffects")
library(ggeffects)

# Compute marginal effects
stiffness_effects <- ggpredict(vimmodel, terms = "Metadata_Stiffness")
print(stiffness_effects)

abbecm_effects <- ggpredict(vimmodel, terms = "Abb_ECM")
print(abbecm_effects)

stiffnessecm_effects <- ggeffect(vimmodel, terms = c("Metadata_Stiffness", "Abb_ECM"))
print(stiffnessecm_effects)

# abbecm_effects <- ggpredict(vimmodel, terms = "Abb_ECM")
# print(abbecm_effects)
# # Plot marginal effects
# plot(marginal_effects)
```

## Interaction Plots from ANOVA
```{r}
DMSOdsewithrepcolreorder <- DMSOdsewithrep

DMSOdsewithrepcolreorder$CollagenIV <- factor(DMSOdsewithrepcolreorder$CollagenIV, levels = c(0,0.25,0.5,0.75,1))
DMSOdsewithrepcolreorder$CollagenI <- factor(DMSOdsewithrepcolreorder$CollagenI, levels = c(0,0.25,0.5,0.75,1))
DMSOdsewithrepcolreorder$Hyaluronic_Acid <- factor(DMSOdsewithrepcolreorder$Hyaluronic_Acid, levels = c(0,0.25,0.5,0.75,1))
DMSOdsewithrepcolreorder$Osteopontin <- factor(DMSOdsewithrepcolreorder$Osteopontin, levels = c(0,0.25,0.5,0.75,1))
DMSOdsewithrepcolreorder$Decorin <- factor(DMSOdsewithrepcolreorder$Decorin, levels = c(0,0.25,0.5,0.75,1))
DMSOdsewithrepcolreorder$Fibronectin <- factor(DMSOdsewithrepcolreorder$Fibronectin, levels = c(0,0.25,0.5,0.75,1))
DMSOdsewithrepcolreorder$Galectin3 <- factor(DMSOdsewithrepcolreorder$Galectin3, levels = c(0,0.25,0.5,0.75,1))
DMSOdsewithrepcolreorder$TenascinC <- factor(DMSOdsewithrepcolreorder$TenascinC, levels = c(0,0.25,0.5,0.75,1))
DMSOdsewithrepcolreorder$Laminin <- factor(DMSOdsewithrepcolreorder$Laminin, levels = c(0,0.25,0.5,0.75,1))
```

```{r}
VEPECMmeansNuc <- DMSOdsewithrepcolreorder %>% group_by(Metadata_Stiffness, Abb_ECM, Laminin, CollagenI, CollagenIV, Hyaluronic_Acid, Fibronectin, Decorin, Osteopontin, Galectin3, TenascinC) %>% summarize(Mean_PXR = mean(Mean_Green_Norm, na.rm = TRUE), Mean_Vim = mean(Mean_Orange_Norm, na.rm = TRUE), Mean_Ecad = mean(Mean_Red_Norm, na.rm = TRUE))
```

### PXR Sig S:R
```{r}
interaction.plot(x.factor = DMSOdsewithrepcolreorder$CollagenIV, trace.factor = DMSOdsewithrepcolreorder$Metadata_Stiffness, response = DMSOdsewithrepcolreorder$Mean_Green_Norm, ylab = "PXR Expression", xlab = "Collagen IV Ratio", trace.label = "Stiffness (kPa)")

interaction.plot(x.factor = DMSOdsewithrepcolreorder$Osteopontin, trace.factor = DMSOdsewithrepcolreorder$Metadata_Stiffness, response = DMSOdsewithrepcolreorder$Mean_Green_Norm, ylab = "PXR Expression", xlab = "Osteopontin Ratio", trace.label = "Stiffness (kPa)")

interaction.plot(x.factor = DMSOdsewithrepcolreorder$Decorin, trace.factor = DMSOdsewithrepcolreorder$Metadata_Stiffness, response = DMSOdsewithrepcolreorder$Mean_Green_Norm, ylab = "PXR Expression", xlab = "Decorin Ratio", trace.label = "Stiffness (kPa)")


VEPECMmeansNuc %>% group_by(Metadata_Stiffness, CollagenIV) %>% summarize(Mean_PXR = mean(Mean_PXR)) %>% ggplot( aes(x = CollagenIV, y = Mean_PXR, col = Metadata_Stiffness))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = Metadata_Stiffness), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("Ratio of Collagen IV")+
  ylab("PXR Expression")+
  scale_color_manual(values = c("#db6d22", "#2100bb"))

  ggsave("PXR Intx/StiffnessvsC1PXR.png")
  
  VEPECMmeansNuc %>% group_by(Metadata_Stiffness, Osteopontin) %>% summarize(Mean_PXR = mean(Mean_PXR)) %>%ggplot( aes(x = Osteopontin, y = Mean_PXR, col = Metadata_Stiffness))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = Metadata_Stiffness), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("Ratio of Osteopontin")+
 ylab("PXR Expression")+
     ggtitle("PXR - Stiffness over Osteopontin Ratio")+
  scale_color_manual(values = c("#db6d22", "#2100bb"))

  ggsave("PXR Intx/StiffnessvsOPNPXR.png")
  
  VEPECMmeansNuc %>% group_by(Metadata_Stiffness, Decorin) %>% summarize(Mean_PXR = mean(Mean_PXR)) %>%ggplot( aes(x = Decorin, y = Mean_PXR, col = Metadata_Stiffness))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = Metadata_Stiffness), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("Ratio of Decorin")+
  ylab("PXR Expression")+
  scale_color_manual(values = c("#db6d22", "#2100bb"))

  ggsave("PXR Intx/StiffnessvsDNPXR.png")
```


### ECAD Sig S:R
```{r}
interaction.plot(x.factor = DMSOdsewithrepcolreorder$Osteopontin, trace.factor = DMSOdsewithrepcolreorder$Metadata_Stiffness, response = DMSOdsewithrepcolreorder$Mean_Red_Norm, ylab = "Ecad Expression", xlab = "Osteopontin Ratio", trace.label = "Stiffness (kPa)")

interaction.plot(x.factor = DMSOdsewithrepcolreorder$Decorin, trace.factor = DMSOdsewithrepcolreorder$Metadata_Stiffness, response = DMSOdsewithrepcolreorder$Mean_Red_Norm, ylab = "Ecad Expression", xlab = "Decorin Ratio", trace.label = "Stiffness (kPa)")

VEPECMmeansNuc %>% group_by(Metadata_Stiffness, Osteopontin) %>% summarize(Mean_Ecad = mean(Mean_Ecad)) %>%ggplot( aes(x = Osteopontin, y = Mean_Ecad, col = Metadata_Stiffness))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = Metadata_Stiffness), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("Ratio of Osteopontin")+
  ylab("Ecad Expression")+
  ggtitle("E-Cadherin - Stiffness over Osteopontin Ratio")+
  scale_color_manual(values = c("#db6d22", "#2100bb"))
ggsave("Ecad Intx/StiffnessvsOPNEcad.png")

VEPECMmeansNuc %>% group_by(Metadata_Stiffness, Decorin) %>% summarize(Mean_Ecad = mean(Mean_Ecad)) %>%ggplot( aes(x = Decorin, y = Mean_Ecad, col = Metadata_Stiffness))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = Metadata_Stiffness), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("Ratio of Decorin")+
  ylab("Ecad Expression")+
  scale_color_manual(values = c("#db6d22", "#2100bb"))

  ggsave("Ecad Intx/StiffnessvsDNEcad.png")
```

### VIM Sig R:ECM
Need to run and then run the next chunk
```{r}
Col1 <- subset(DMSOdsewithrepcolreorder, CollagenI != 0)
Col4 <- subset(DMSOdsewithrepcolreorder, CollagenIV != 0)
HA <- subset(DMSOdsewithrepcolreorder, Hyaluronic_Acid != 0)
FN <- subset(DMSOdsewithrepcolreorder, Fibronectin != 0)
G3 <- subset(DMSOdsewithrepcolreorder, Galectin3 != 0)

Col1$Abb_ECM <- factor(Col1$Abb_ECM, levels = c("C1", "C1DN", "C1C4", "C1G3",  "C1OPN","C1LN" ,"C1TC" ,"C1FN" ,"C1HA" ))
Col4$Abb_ECM <- factor(Col4$Abb_ECM, levels = c("C4", "C1C4"  ,"C4OPN", "C4HA",  "C4FN"  ,"C4G3"  ,"C4LN" , "C4TC" , "C4DN"))
HA$Abb_ECM <- factor(HA$Abb_ECM, levels = c("HA", "HAFN" , "HAG3"  ,"HAOPN" ,"C4HA" , "LNHA",  "TCHA", "HADN",  "C1HA"))
FN$Abb_ECM <- factor(FN$Abb_ECM, levels = c("FN", "HAFN", "OPNFN", "LNFN",  "G3FN","DNFN" ,"TCFN" ,  "C4FN" , "C1FN" ))
G3$Abb_ECM <- factor(G3$Abb_ECM, levels = c("G3", "HAG3" , "LNG3" , "OPNG3", "C1G3" , "G3FN" ,"C4G3", "DNG3"  ,"TCG3" ))

```

```{r}
interaction.plot(x.factor = Col1$Abb_ECM, trace.factor = droplevels(Col1)$CollagenI, response = Col1$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Collagen I Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)


interaction.plot(x.factor = Col4$Abb_ECM, trace.factor = droplevels(Col4)$CollagenIV, response = Col4$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Collagen IV Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

interaction.plot(x.factor = HA$Abb_ECM, trace.factor = droplevels(HA)$Hyaluronic_Acid, response = HA$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Hyaluronic Acid Ratio",  col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

interaction.plot(x.factor = FN$Abb_ECM, trace.factor = droplevels(FN)$Fibronectin, response = FN$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Fibronectin Ratio",  col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

interaction.plot(x.factor = G3$Abb_ECM, trace.factor = droplevels(G3)$Galectin3, response = G3$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Galectin 3 Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

VEPECMmeansNuc %>% filter(CollagenI != 0) %>% group_by(Abb_ECM, CollagenI) %>% summarize(Mean_Vim = mean(Mean_Vim)) %>%ggplot( aes(x = Abb_ECM, y = Mean_Vim, col = CollagenI))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = CollagenI, linetype = CollagenI), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("ECM Composition")+
  labs(color = "Collagen I")+
  scale_color_manual(values  = c( "#444E7E", "#FEB424","#D8511D", "#8087AA")) +
  scale_linetype_manual(values = c("longdash", "solid", "twodash", "solid"))+
  ylab("Vimentin Expression")+
  ggtitle("Collagen I Ratio over ECMs")
  
ggsave("Vim Intx/CollagenIRatiovsECMEdU.png", width = 10, height = 5)

VEPECMmeansNuc %>% filter(CollagenIV != 0) %>% group_by(Abb_ECM, CollagenIV) %>% summarize(Mean_Vim = mean(Mean_Vim)) %>%ggplot( aes(x = Abb_ECM, y = Mean_Vim, col = CollagenIV))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = CollagenIV, linetype = CollagenIV), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("ECM Composition")+
  labs(color = "Collagen IV")+
  scale_color_manual(values  = c( "#444E7E", "#FEB424","#D8511D", "#8087AA")) +
  scale_linetype_manual(values = c("longdash", "solid", "twodash", "solid"))+
  ylab("Vimentin Expression")+
  ggtitle("Collagen IV Ratio over ECMs")
  
ggsave("Vim Intx/CollagenIVRatiovsECMEdU.png", width = 10, height = 5)

VEPECMmeansNuc %>% filter(Hyaluronic_Acid != 0) %>% group_by(Abb_ECM, Hyaluronic_Acid) %>% summarize(Mean_Vim = mean(Mean_Vim)) %>%ggplot( aes(x = Abb_ECM, y = Mean_Vim, col = Hyaluronic_Acid))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = Hyaluronic_Acid, linetype = Hyaluronic_Acid), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("ECM Composition")+
  labs(color = "Hyaluronic Acid")+
  scale_color_manual(values  = c( "#444E7E", "#FEB424","#D8511D", "#8087AA")) +
  scale_linetype_manual(values = c("longdash", "solid", "twodash", "solid"))+
  ylab("Vimentin Expression")+
  ggtitle("Hyaluronic Acid Ratio over ECMs")
  
ggsave("Vim Intx/Hyaluronic_AcidRatiovsECMEdU.png", width = 10, height = 5)

VEPECMmeansNuc %>% filter(Fibronectin != 0) %>% group_by(Abb_ECM, Fibronectin) %>% summarize(Mean_Vim = mean(Mean_Vim)) %>%ggplot( aes(x = Abb_ECM, y = Mean_Vim, col = Fibronectin))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = Fibronectin, linetype = Fibronectin), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("ECM Composition")+
  labs(color = "Fibronectin")+
  scale_color_manual(values  = c( "#444E7E", "#FEB424","#D8511D", "#8087AA")) +
  scale_linetype_manual(values = c("longdash", "solid", "twodash", "solid"))+
  ylab("Vimentin Expression")+
  ggtitle("Fibronectin Ratio over ECMs")
  
ggsave("Vim Intx/FibronectinRatiovsECMEdU.png", width = 10, height = 5)

VEPECMmeansNuc %>% filter(Galectin3 != 0) %>% group_by(Abb_ECM, Galectin3) %>% summarize(Mean_Vim = mean(Mean_Vim)) %>%ggplot( aes(x = Abb_ECM, y = Mean_Vim, col = Galectin3))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = Galectin3, linetype = Galectin3), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("ECM Composition")+
  labs(color = "Galectin 3")+
  scale_color_manual(values  = c( "#444E7E", "#FEB424","#D8511D", "#8087AA")) +
  scale_linetype_manual(values = c("longdash", "solid", "twodash", "solid"))+
  ylab("Vimentin Expression")+
  ggtitle("Vimentin - Galectin 3 Ratio over ECMs")
  
ggsave("Vim Intx/Galectin3RatiovsECMEdU.png", width = 10, height = 5)
```
### PXR Sig R:ECM
```{r}
interaction.plot(x.factor = G3$Abb_ECM, trace.factor = droplevels(G3)$Galectin3, response = G3$Mean_Green_Norm, ylab = "PXR Expression", xlab = "ECM Condition", trace.label = "Galectin 3 Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

VEPECMmeansNuc %>% filter(Galectin3 != 0) %>% group_by(Abb_ECM, Galectin3) %>% summarize(Mean_PXR = mean(Mean_PXR)) %>%ggplot( aes(x = Abb_ECM, y = Mean_PXR, col = Galectin3))+
  #facet_grid(cols = vars(Metadata_Stiffness))+
  geom_path(aes(group = Galectin3, linetype = Galectin3), linewidth = 1.5)+
  geom_point(size = 3)+
  theme_prism(border = TRUE)+
  xlab("ECM Composition")+
  labs(color = "Galectin 3")+
  scale_color_manual(values  = c( "#444E7E", "#FEB424","#D8511D", "#8087AA")) +
  scale_linetype_manual(values = c("longdash", "solid", "twodash", "solid"))+
  ylab("PXR Expression")+
  ggtitle("PXR - Galectin 3 Ratio over ECMs")
  
ggsave("PXR Intx/Galectin3RatiovsECMPXR.png", width = 10, height = 5)
```
## Main Factor Plots

### Ratio Vimentin
```{r}
levels <- c(0, 0.25, 0.5, 0.75, 1)
comparisons <- combn(as.character(levels), 2, simplify = FALSE)
```

```{r}
DMSOdsewithrepcolreorder %>% ggplot(aes(x = CollagenIV, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Collagen IV in Vimentin")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Collagen IV")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("VimCol4Ratio.png", width = 10, height =5)

DMSOdsewithrepcolreorder %>% ggplot(aes(x = TenascinC, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Tenascin C in Vimentin")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Tenascin C")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("VimTCRatio.png", width = 10, height =5)

DMSOdsewithrepcolreorder %>% ggplot(aes(x = Galectin3, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Galectin 3 in Vimentin")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Galectin 3")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("VimG3Ratio.png", width = 10, height =5)

DMSOdsewithrepcolreorder %>% ggplot(aes(x = Laminin, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Laminin in Vimentin")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Laminin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("VimLNRatio.png", width = 10, height =5)

DMSOdsewithrepcolreorder %>% ggplot(aes(x = Fibronectin, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Fibronectin in Vimentin")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Fibronectin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("VimFNRatio.png", width = 10, height =5)

DMSOdsewithrepcolreorder %>% ggplot(aes(x = Osteopontin, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Osteopontin in Vimentin")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Osteopontin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("VimOPNRatio.png", width = 10, height =5)
```

### Ratio Ecad
```{r}
DMSOdsewithrepcolreorder %>% ggplot(aes(x = CollagenI, y = Mean_Red_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Collagen I in Ecad")+
  ylab("Ecad Expression")+
  xlab("Ratio of Collagen I")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("EcadCol1Ratio.png", width = 10, height =5)

DMSOdsewithrepcolreorder %>% ggplot(aes(x = Osteopontin, y = Mean_Red_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Osteopontin in Ecad")+
  ylab("Ecad Expression")+
  xlab("Ratio of Osteopontin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("EcadOPNRatio.png", width = 10, height =5)
```

### Ratio PXR

```{r}
DMSOdsewithrepcolreorder %>% ggplot(aes(x = Laminin, y = Mean_Green_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Laminin in PXR")+
  ylab("PXR Expression")+
  xlab("Ratio of Laminin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("PXRLNRatio.png", width = 10, height =5)
```

### Abb_ECM
Try to work with the p-value heatmaps?

#### Compare Means 
```{r}
ECMVimCM <- compare_means(Mean_Orange_Norm ~ Abb_ECM, DMSOdsewithrep)
ECMEcadCM <- compare_means(Mean_Red_Norm ~ Abb_ECM, DMSOdsewithrep)
ECMPXRCM <- compare_means(Mean_Green_Norm ~ Abb_ECM, DMSOdsewithrep)
```

```{r}
write.csv(ECMVimCM, "ECMVimCM.csv")
write.csv(ECMEcadCM, "ECMEcadCM.csv")
write.csv(ECMPXRCM, "ECMPXRCM.csv")
```

#### P-value Heatmap
```{r}
ggplot(ECMVimCMExpanded, aes(x = group1, y = group2, fill= p)) +
  geom_tile() +
  #geom_text(aes(label=round(Avg_Mean_Objects,1),
              #  color=ifelse(Avg_Mean_Objects>75,"black","white")),size=6)+
  #scale_color_manual(values=c("white"="white","black"="black"),guide="none")+
  labs(title = "Vimentin on ECM Combinations", x = "ECM 1", y = "ECM 2",fill="p-value")+
  scale_fill_viridis_c(limit = c(0, 0.05), option = "D", na.value = "gray")+
  #scale_fill_distiller(limit = c(0, 0.05), palette=("Viridis"),direction=-1,na.value="gray")+
  geom_abline(intercept=0,slope=1,color="black",linetype="dashed")+
  theme_prism()+
  coord_fixed()+
theme(title=element_text(size=30),
      axis.title.x = element_text(size= 30),
      axis.text.x = element_text( angle = 90, vjust = 0.5),
      axis.title.y = element_text(size= 30),
      axis.text.y = element_text( vjust = 0.5),
      legend.text = element_text(size = 20),
      legend.key.height = unit(0.9, "in"),
      legend.title = element_text(size = 30),
      strip.text =  element_text(size = 30))
ggsave(filename = "VimECMcomparison.png",
        width = 12, height = 9,units="in", dpi = 300)

ggplot(ECMEcadCMExpanded, aes(x = group1, y = group2, fill= p)) +
  geom_tile() +
  #geom_text(aes(label=round(Avg_Mean_Objects,1),
              #  color=ifelse(Avg_Mean_Objects>75,"black","white")),size=6)+
  #scale_color_manual(values=c("white"="white","black"="black"),guide="none")+
  labs(title = "Ecad on ECM Combinations", x = "ECM 1", y = "ECM 2",fill="p-value")+
  scale_fill_viridis_c(limit = c(0, 0.05), option = "D", na.value = "gray")+
  #scale_fill_distiller(limit = c(0, 0.05), palette=("Viridis"),direction=-1,na.value="gray")+
  geom_abline(intercept=0,slope=1,color="black",linetype="dashed")+
  theme_prism()+
  coord_fixed()+
theme(title=element_text(size=30),
      axis.title.x = element_text(size= 30),
      axis.text.x = element_text( angle = 90, vjust = 0.5),
      axis.title.y = element_text(size= 30),
      axis.text.y = element_text( vjust = 0.5),
      legend.text = element_text(size = 20),
      legend.key.height = unit(0.9, "in"),
      legend.title = element_text(size = 30),
      strip.text =  element_text(size = 30))
ggsave(filename = "EcadECMcomparison.png",
        width = 12, height = 9,units="in", dpi = 300)

ggplot(ECMPXRCMExpanded, aes(x = group1, y = group2, fill= p)) +
  geom_tile() +
  #geom_text(aes(label=round(Avg_Mean_Objects,1),
              #  color=ifelse(Avg_Mean_Objects>75,"black","white")),size=6)+
  #scale_color_manual(values=c("white"="white","black"="black"),guide="none")+
  labs(title = "PXR on ECM Combinations", x = "ECM 1", y = "ECM 2",fill="p-value")+
  scale_fill_viridis_c(limit = c(0, 0.05), option = "D", na.value = "gray")+
  #scale_fill_distiller(limit = c(0, 0.05), palette=("Viridis"),direction=-1,na.value="gray")+
  geom_abline(intercept=0,slope=1,color="black",linetype="dashed")+
  theme_prism()+
  coord_fixed()+
theme(title=element_text(size=30),
      axis.title.x = element_text(size= 30),
      axis.text.x = element_text( angle = 90, vjust = 0.5),
      axis.title.y = element_text(size= 30),
      axis.text.y = element_text( vjust = 0.5),
      legend.text = element_text(size = 20),
      legend.key.height = unit(0.9, "in"),
      legend.title = element_text(size = 30),
      strip.text =  element_text(size = 30))
ggsave(filename = "PXRECMcomparison.png",
        width = 12, height = 9,units="in", dpi = 300)
```
#### Box Plots
```{r}
DMSOdsewithrep %>% ggplot(aes(x = Abb_ECM, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+ 
  ggtitle("Vimentin Expression on ECM Combinations")+
  ylab("Vimentin Expression")+
  xlab("ECM Composition")+
  theme(axis.text.x = element_text(angle = 90))

DMSOdsewithrep %>% ggplot(aes(x = Abb_ECM, y = Mean_Red_Norm))+
  geom_boxplot()+
  theme_prism()+ 
  ggtitle("Ecad Expression on ECM Combinations")+
  ylab("Ecad Expression")+
  xlab("ECM Composition")+
  theme(axis.text.x = element_text(angle = 90))

DMSOdsewithrep %>% ggplot(aes(x = Abb_ECM, y = Mean_Green_Norm))+
  geom_boxplot()+
  theme_prism()+ 
  ggtitle("PXR Expression on ECM Combinations")+
  ylab("PXR Expression")+
  xlab("ECM Composition")+
  theme(axis.text.x = element_text(angle = 90))
```

```{r}
DMSOdsewithrep %>% filter(Abb_ECM %in% c("C1DN", "DNFN")) %>% ggplot(aes(x = Abb_ECM, y = Mean_Red_Norm))+
  geom_boxplot()+
  stat_compare_means()+
  theme_prism()

DMSOdsewithrep %>% filter(Abb_ECM %in% c("C1DN", "C1")) %>% ggplot(aes(x = Abb_ECM, y = Mean_Red_Norm))+
  geom_boxplot()+
  stat_compare_means()+
  theme_prism()

DMSOdsewithrep %>% filter(Abb_ECM %in% c("C1DN", "DN")) %>% ggplot(aes(x = Abb_ECM, y = Mean_Red_Norm))+
  geom_boxplot()+
  stat_compare_means()+
  theme_prism()

DMSOdsewithrep %>% filter(Abb_ECM %in% c("C1TC", "C1C4")) %>% ggplot(aes(x = Abb_ECM, y = Mean_Green_Norm))+
  geom_boxplot()+
  stat_compare_means()+
  theme_prism()

DMSOdsewithrep %>% filter(Abb_ECM %in% c("C1TC", "DNFN")) %>% ggplot(aes(x = Abb_ECM, y = Mean_Green_Norm))+
  geom_boxplot()+
  stat_compare_means()+
  theme_prism()
```
##Drug Model
### Interaction Plots
```{r}
Drugdsewithrepcolreorder <- Drugdsewithrep

Drugdsewithrepcolreorder$CollagenIV <- factor(Drugdsewithrepcolreorder$CollagenIV, levels = c(0,0.25,0.5,0.75,1))
Drugdsewithrepcolreorder$CollagenI <- factor(Drugdsewithrepcolreorder$CollagenI, levels = c(0,0.25,0.5,0.75,1))
Drugdsewithrepcolreorder$Hyaluronic_Acid <- factor(Drugdsewithrepcolreorder$Hyaluronic_Acid, levels = c(0,0.25,0.5,0.75,1))
Drugdsewithrepcolreorder$Osteopontin <- factor(Drugdsewithrepcolreorder$Osteopontin, levels = c(0,0.25,0.5,0.75,1))
Drugdsewithrepcolreorder$Decorin <- factor(Drugdsewithrepcolreorder$Decorin, levels = c(0,0.25,0.5,0.75,1))
Drugdsewithrepcolreorder$Fibronectin <- factor(Drugdsewithrepcolreorder$Fibronectin, levels = c(0,0.25,0.5,0.75,1))
Drugdsewithrepcolreorder$Galectin3 <- factor(Drugdsewithrepcolreorder$Galectin3, levels = c(0,0.25,0.5,0.75,1))
Drugdsewithrepcolreorder$TenascinC <- factor(Drugdsewithrepcolreorder$TenascinC, levels = c(0,0.25,0.5,0.75,1))
Drugdsewithrepcolreorder$Laminin <- factor(Drugdsewithrepcolreorder$Laminin, levels = c(0,0.25,0.5,0.75,1))
```

### Ratio:ECM
```{r}
Col1drug <- subset(Drugdsewithrepcolreorder, CollagenI != 0)
Col4drug <- subset(Drugdsewithrepcolreorder, CollagenIV != 0)
HAdrug <- subset(Drugdsewithrepcolreorder, Hyaluronic_Acid != 0)
TCdrug <- subset(Drugdsewithrepcolreorder, TenascinC != 0)
FNdrug <- subset(Drugdsewithrepcolreorder, Fibronectin != 0)
LNdrug <- subset(Drugdsewithrepcolreorder, Laminin != 0)
G3drug <- subset(Drugdsewithrepcolreorder, Galectin3 != 0)

Col1drug$Abb_ECM <- factor(Col1drug$Abb_ECM, levels = c("C1", "C1DN", "C1C4", "C1G3",  "C1OPN","C1LN" ,"C1TC" ,"C1FN" ,"C1HA" ))
Col4drug$Abb_ECM <- factor(Col4drug$Abb_ECM, levels = c("C4", "C1C4"  ,"C4OPN", "C4HA",  "C4FN"  ,"C4G3"  ,"C4LN" , "C4TC" , "C4DN"))
HAdrug$Abb_ECM <- factor(HAdrug$Abb_ECM, levels = c("HA", "HAFN" , "HAG3"  ,"HAOPN" ,"C4HA" , "LNHA",  "TCHA", "HADN",  "C1HA"))
FNdrug$Abb_ECM <- factor(FNdrug$Abb_ECM, levels = c("FN", "HAFN", "OPNFN", "LNFN",  "G3FN","DNFN" ,"TCFN" ,  "C4FN" , "C1FN" ))
G3drug$Abb_ECM <- factor(G3drug$Abb_ECM, levels = c("G3", "HAG3" , "LNG3" , "OPNG3", "C1G3" , "G3FN" ,"C4G3", "DNG3"  ,"TCG3" ))

LNdrug$Abb_ECM <- factor(LNdrug$Abb_ECM, levels = c("LN", "LNG3", "LNDN", "LNFN",  "LNHA","C1LN" ,"C4LN" ,"LNTC" ,"LNOPN" ))
TCdrug$Abb_ECM <- factor(TCdrug$Abb_ECM, levels = c("TC", "TCDN", "TCG3", "TCFN", "C1TC", "C4TC","TCOPN" ,"TCHA" ,"LNTC"))
```

#### Vim
```{r}
interaction.plot(x.factor = Col1drug$Abb_ECM, trace.factor = droplevels(Col1drug)$CollagenI, response = Col1drug$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Collagen I Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

interaction.plot(x.factor = TCdrug$Abb_ECM, trace.factor = droplevels(TCdrug)$Tenascin, response = TCdrug$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Tenascin C Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

interaction.plot(x.factor = LNdrug$Abb_ECM, trace.factor = droplevels(LNdrug)$Laminin, response = LNdrug$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Laminin Ratio",  col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

interaction.plot(x.factor = FNdrug$Abb_ECM, trace.factor = droplevels(FNdrug)$Fibronectin, response = FNdrug$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Fibronectin Ratio",  col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

interaction.plot(x.factor = G3drug$Abb_ECM, trace.factor = droplevels(G3drug)$Galectin3, response = G3drug$Mean_Orange_Norm, ylab = "Vimentin Expression", xlab = "ECM Condition", trace.label = "Galectin 3 Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

```
#### Ecad
```{r}
interaction.plot(x.factor = TCdrug$Abb_ECM, trace.factor = droplevels(TCdrug)$Tenascin, response = TCdrug$Mean_Orange_Norm, ylab = "Ecad Expression", xlab = "ECM Condition", trace.label = "Tenascin C Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

interaction.plot(x.factor = HAdrug$Abb_ECM, trace.factor = droplevels(HAdrug)$Hyaluronic_Acid, response = HAdrug$Mean_Red_Norm, ylab = "Ecad Expression", xlab = "ECM Condition", trace.label = "Hyaluronic Acid Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)
```
#### PXR
```{r}
interaction.plot(x.factor = LNdrug$Abb_ECM, trace.factor = droplevels(LNdrug)$Laminin, response = LNdrug$Mean_Green_Norm, ylab = "PXR Expression", xlab = "ECM Condition", trace.label = "Laminin Ratio",  col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)

interaction.plot(x.factor = FNdrug$Abb_ECM, trace.factor = droplevels(FNdrug)$Fibronectin, response = FNdrug$Mean_Green_Norm, ylab = "PXR Expression", xlab = "ECM Condition", trace.label = "Fibronectin Ratio",  col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2)
```
### 3 Way Ecad
```{r}
interaction.plot(x.factor = subset(HAdrug, Metadata_Stiffness == "1kPa")$Abb_ECM, trace.factor = droplevels(subset(HAdrug, Metadata_Stiffness == "1kPa"))$Hyaluronic_Acid, response = subset(HAdrug, Metadata_Stiffness == "1kPa")$Mean_Red_Norm, ylab = "Ecad Expression", xlab = "ECM Condition 1 kPa", trace.label = "Hyaluronic Acid Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2, ylim = c(0,0.07))

interaction.plot(x.factor = subset(HAdrug, Metadata_Stiffness == "25kPa")$Abb_ECM, trace.factor = droplevels(subset(HAdrug, Metadata_Stiffness == "25kPa"))$Hyaluronic_Acid, response = subset(HAdrug, Metadata_Stiffness == "25kPa")$Mean_Red_Norm, ylab = "Ecad Expression", xlab = "ECM Condition 25 kPa", trace.label = "Hyaluronic Acid Ratio", col = 1:5, type = "b", pch = 16, fixed = TRUE, las = 2, ylim = c(0,0.07))
```
### Main Factor Plots
#### Vim Ratio
```{r}
Drugdsewithrepcolreorder %>% ggplot(aes(x = CollagenIV, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Collagen IV in Vimentin in Drug")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Collagen IV")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("VimCol4Ratio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = Hyaluronic_Acid, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Hyaluronic Acid in Vimentin in Drug")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Hyaluronic Acid")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugVimHARatio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = Galectin3, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Galectin 3 in Vimentin in Drug")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Galectin 3")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugVimG3Ratio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = Laminin, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Laminin in Vimentin in Drug")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Laminin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugVimLNRatio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = Decorin, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Decorin in Vimentin in Drug")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Decorin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugVimDNRatio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = Osteopontin, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Osteopontin in Vimentin in Drug")+
  ylab("Vimentin Expression")+
  xlab("Ratio of Osteopontin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugVimOPNRatio.png", width = 10, height =5)
```

#### Ecad Ratio
```{r}
Drugdsewithrepcolreorder %>% ggplot(aes(x = CollagenI, y = Mean_Red_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Collagen I in Ecad in Drug")+
  ylab("Ecad Expression")+
  xlab("Ratio of Collagen I")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugEcadCol1Ratio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = CollagenIV, y = Mean_Red_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Collagen IV in Ecad in Drug")+
  ylab("Ecad Expression")+
  xlab("Ratio of Collagen IV")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugEcadCol4Ratio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = Laminin, y = Mean_Red_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Laminin in Ecad in Drug")+
  ylab("Ecad Expression")+
  xlab("Ratio of Laminin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugEcadLamRatio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = Galectin3, y = Mean_Red_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Galectin 3 in Ecad in Drug")+
  ylab("Ecad Expression")+
  xlab("Ratio of Galectin 3")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugEcadG3Ratio.png", width = 10, height =5)
```

#### PXR Ratio
```{r}
Drugdsewithrepcolreorder %>% ggplot(aes(x = CollagenI, y = Mean_Green_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Collagen I in PXR in Drug")+
  ylab("PXR Expression")+
  xlab("Ratio of Collagen I")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugPXRC1Ratio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = Laminin, y = Mean_Green_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Laminin in PXR in Drug")+
  ylab("PXR Expression")+
  xlab("Ratio of Laminin")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugPXRLNRatio.png", width = 10, height =5)

Drugdsewithrepcolreorder %>% ggplot(aes(x = Galectin3, y = Mean_Green_Norm))+
  geom_boxplot()+
  theme_prism()+
  ggtitle("Ratio of Galectin 3 in PXR in Drug")+
  ylab("PXR Expression")+
  xlab("Ratio of Galectin 3")+
  stat_compare_means(comparisons = comparisons, label = "p.signif", test = "t.test", hide.ns = TRUE)
ggsave("DrugPXRG3Ratio.png", width = 10, height =5)
```
#### Abb_ECMs

##### Compare Means 
```{r}
ECMVimDrugCM <- compare_means(Mean_Orange_Norm ~ Abb_ECM, Drugdsewithrep)
ECMEcadDrugCM <- compare_means(Mean_Red_Norm ~ Abb_ECM, Drugdsewithrep)
ECMPXRDrugCM <- compare_means(Mean_Green_Norm ~ Abb_ECM, Drugdsewithrep)
```

```{r}
write.csv(ECMVimDrugCM, "ECMVimDrugCM.csv")
write.csv(ECMEcadDrugCM, "ECMEcadDrugCM.csv")
write.csv(ECMPXRDrugCM, "ECMPXRDrugCM.csv")
```

##### P-value Heatmap
```{r}
ggplot(ECMVimDrugCMExpanded, aes(x = group1, y = group2, fill= p)) +
  geom_tile() +
  #geom_text(aes(label=round(Avg_Mean_Objects,1),
              #  color=ifelse(Avg_Mean_Objects>75,"black","white")),size=6)+
  #scale_color_manual(values=c("white"="white","black"="black"),guide="none")+
  labs(title = "Vimentin on ECM Combinations in Drug", x = "ECM 1", y = "ECM 2",fill="p-value")+
  scale_fill_viridis_c(limit = c(0, 0.05), option = "D", na.value = "gray")+
  #scale_fill_distiller(limit = c(0, 0.05), palette=("Viridis"),direction=-1,na.value="gray")+
  geom_abline(intercept=0,slope=1,color="black",linetype="dashed")+
  theme_prism()+
  coord_fixed()+
theme(title=element_text(size=30),
      axis.title.x = element_text(size= 30),
      axis.text.x = element_text( angle = 90, vjust = 0.5),
      axis.title.y = element_text(size= 30),
      axis.text.y = element_text( vjust = 0.5),
      legend.text = element_text(size = 20),
      legend.key.height = unit(0.9, "in"),
      legend.title = element_text(size = 30),
      strip.text =  element_text(size = 30))
ggsave(filename = "VimECMDrugcomparison.png",
        width = 12, height = 9,units="in", dpi = 300)

ggplot(ECMEcadDrugCMExpanded, aes(x = group1, y = group2, fill= p)) +
  geom_tile() +
  #geom_text(aes(label=round(Avg_Mean_Objects,1),
              #  color=ifelse(Avg_Mean_Objects>75,"black","white")),size=6)+
  #scale_color_manual(values=c("white"="white","black"="black"),guide="none")+
  labs(title = "Ecad on ECM Combinations in Drug", x = "ECM 1", y = "ECM 2",fill="p-value")+
  scale_fill_viridis_c(limit = c(0, 0.05), option = "D", na.value = "gray")+
  #scale_fill_distiller(limit = c(0, 0.05), palette=("Viridis"),direction=-1,na.value="gray")+
  geom_abline(intercept=0,slope=1,color="black",linetype="dashed")+
  theme_prism()+
  coord_fixed()+
theme(title=element_text(size=30),
      axis.title.x = element_text(size= 30),
      axis.text.x = element_text( angle = 90, vjust = 0.5),
      axis.title.y = element_text(size= 30),
      axis.text.y = element_text( vjust = 0.5),
      legend.text = element_text(size = 20),
      legend.key.height = unit(0.9, "in"),
      legend.title = element_text(size = 30),
      strip.text =  element_text(size = 30))
ggsave(filename = "EcadECMDrugcomparison.png",
        width = 12, height = 9,units="in", dpi = 300)

ggplot(ECMPXRDrugCMExpanded, aes(x = group1, y = group2, fill= p)) +
  geom_tile() +
  #geom_text(aes(label=round(Avg_Mean_Objects,1),
              #  color=ifelse(Avg_Mean_Objects>75,"black","white")),size=6)+
  #scale_color_manual(values=c("white"="white","black"="black"),guide="none")+
  labs(title = "PXR on ECM Combinations in Drug", x = "ECM 1", y = "ECM 2",fill="p-value")+
  scale_fill_viridis_c(limit = c(0, 0.05), option = "D", na.value = "gray")+
  #scale_fill_distiller(limit = c(0, 0.05), palette=("Viridis"),direction=-1,na.value="gray")+
  geom_abline(intercept=0,slope=1,color="black",linetype="dashed")+
  theme_prism()+
  coord_fixed()+
theme(title=element_text(size=30),
      axis.title.x = element_text(size= 30),
      axis.text.x = element_text( angle = 90, vjust = 0.5),
      axis.title.y = element_text(size= 30),
      axis.text.y = element_text( vjust = 0.5),
      legend.text = element_text(size = 20),
      legend.key.height = unit(0.9, "in"),
      legend.title = element_text(size = 30),
      strip.text =  element_text(size = 30))
ggsave(filename = "PXRECMDrugcomparison.png",
        width = 12, height = 9,units="in", dpi = 300)
```
##### Box Plots
```{r}
Drugdsewithrep %>% ggplot(aes(x = Abb_ECM, y = Mean_Orange_Norm))+
  geom_boxplot()+
  theme_prism()+ 
  ggtitle("Vimentin Expression on ECM Combinations in Drug")+
  ylab("Vimentin Expression")+
  xlab("ECM Composition")+
  theme(axis.text.x = element_text(angle = 90))

Drugdsewithrep %>% ggplot(aes(x = Abb_ECM, y = Mean_Red_Norm))+
  geom_boxplot()+
  theme_prism()+ 
  ggtitle("Ecad Expression on ECM Combinations in Drug")+
  ylab("Ecad Expression")+
  xlab("ECM Composition")+
  theme(axis.text.x = element_text(angle = 90))

Drugdsewithrep %>% ggplot(aes(x = Abb_ECM, y = Mean_Green_Norm))+
  geom_boxplot()+
  theme_prism()+ 
  ggtitle("PXR Expression on ECM Combinations in Drug")+
  ylab("PXR Expression")+
  xlab("ECM Composition")+
  theme(axis.text.x = element_text(angle = 90))
```
## Ranked Bar Plots
```{r}
## Mean_Green
DMSOdsewithrep %>% group_by(Conditions) %>% summarize(Green = mean(Mean_Green_Norm), GreenSE = sd(Mean_Green_Norm)/sqrt(length(Mean_Green_Norm))) %>% ggplot(aes(x = reorder(Conditions, - Green), y = Green))+
  #facet_grid(rows = vars(Metadata_Ratio))+
  geom_col()+
  theme_prism()+
  ggtitle("Average PXR Expression")+
  ylab("Average PXR Expression")+
  xlab("ECM & Ratio Combinations")+
 # ylim(c(0,0.20))+
  theme(axis.text.x = element_text(angle = 90))+
  geom_errorbar(aes(ymin  = Green - GreenSE, ymax = Green + GreenSE))

ggsave("PXRRankedRatio.png", height = 6, width = 24)

## Mean_Orange
DMSOdsewithrep %>% group_by(Conditions) %>% summarize(Orange = mean(Mean_Orange_Norm), OrangeSE = sd(Mean_Orange_Norm)/sqrt(length(Mean_Orange_Norm))) %>% ggplot(aes(x = reorder(Conditions, - Orange), y = Orange))+
  #facet_grid(rows = vars(Metadata_Ratio))+
  geom_col()+
  theme_prism()+
  ggtitle("Average Vimentin Expression")+
  ylab("Average Vimentin Expression")+
  xlab("ECM & Ratio Combinations")+
 # ylim(c(0,0.20))+
  theme(axis.text.x = element_text(angle = 90))+
  geom_errorbar(aes(ymin  = Orange - OrangeSE, ymax = Orange + OrangeSE))

ggsave("VimRankedRatio.png", height = 6, width = 24)

## Mean_Red
DMSOdsewithrep %>% group_by(Conditions) %>% summarize(Red = mean(Mean_Red_Norm), RedSE = sd(Mean_Red_Norm)/sqrt(length(Mean_Red_Norm))) %>% ggplot(aes(x = reorder(Conditions, - Red), y = Red))+
  #facet_grid(rows = vars(Metadata_Ratio))+
  geom_col()+
  theme_prism()+
  ggtitle("Average Ecad Expression")+
  ylab("Average Ecad Expression")+
  xlab("ECM & Ratio Combinations")+
 # ylim(c(0,0.20))+
  theme(axis.text.x = element_text(angle = 90))+
  geom_errorbar(aes(ymin  = Red - RedSE, ymax = Red + RedSE))

ggsave("EcadRankedRatio.png", height = 6, width = 24)

```
## Abb_ECM Box Heatmaps
```{r}
heatmap_12 <- DMSOdsewithrep %>% group_by(Abb_ECM, Metadata_Ratio) %>% 
  summarize(Mean_Green = mean(Mean_Green_Norm),
            Mean_Orange = mean(Mean_Orange_Norm),
            Mean_Red = mean(Mean_Red_Norm))
write.csv(heatmap_12, "heatmap_12.csv")
```
Create expanded dataset (with reversed ECMs) before next step
```{r}
colnames(heatmap_12ex) <- c("...1", "Abb_ECM", "Metadata_Ratio", "Mean_PXR", "Mean_Vimentin", "Mean_Ecad", "ECM1", "ECM2")

DMSO25 <- heatmap_12ex %>% filter(Metadata_Ratio %in% c("25/75", "100")) 
DMSO50 <- heatmap_12ex %>% filter(Metadata_Ratio %in% c("50/50", "100"))
DMSO75 <- heatmap_12ex %>% filter(Metadata_Ratio %in% c("75/25", "100")) 
```

```{r}
# Define the list of columns to use for the 'fill' aesthetic
fill_columns <- c("Mean_PXR","Mean_Ecad","Mean_Vimentin") # Add all the column names you need here

datasets <- list(DMSO25, DMSO50, DMSO75) 

# Loop through each column name
for (fill_column in fill_columns) {
  
  min_value <- min(sapply(datasets, function(df) min(df[[fill_column]], na.rm = TRUE)))
  max_value <- max(sapply(datasets, function(df) max(df[[fill_column]], na.rm = TRUE)))
  
  # Generate individual plots for each dataset with dynamic fill
  a <- ggplot(DMSO25, aes(x = ECM1, y = ECM2, fill = .data[[fill_column]])) +
    geom_tile() +
    coord_fixed() + 
    theme_prism() + 
    ggtitle("25:75") +
    scale_fill_viridis(limits = c(min_value, max_value)) +
    theme(axis.text.x = element_text(size = 25),
          axis.title.x = element_text(size = 25),
          axis.text.y = element_text(size = 25), 
          axis.title.y = element_text(size = 25),
          legend.key.height = unit(1, "in"),
          legend.text = element_text(size = 25),
          plot.title = element_text(size = 30),
          panel.background = element_blank(),
          strip.text = element_text(size = 25),
          panel.border = element_rect(colour = "black", fill = NA, size = 1))
  
  b <- ggplot(DMSO50, aes(x = ECM1, y = ECM2, fill = .data[[fill_column]])) +
    geom_tile() +
    coord_fixed() + 
    theme_prism() + 
    ggtitle("50:50") +
    scale_fill_viridis(limits = c(min_value, max_value)) +
    theme(axis.text.x = element_text(size = 25),
          axis.title.x = element_text(size = 25),
          axis.text.y = element_text(size = 25), 
          axis.title.y = element_text(size = 25),
          legend.key.height = unit(1, "in"),
          legend.text = element_text(size = 25),
          plot.title = element_text(size = 30),
          panel.background = element_blank(),
          strip.text = element_text(size = 25),
          panel.border = element_rect(colour = "black", fill = NA, size = 1))
  
  c <- ggplot(DMSO75, aes(x = ECM1, y = ECM2, fill = .data[[fill_column]])) +
    geom_tile() +
    coord_fixed() + 
    theme_prism() + 
    ggtitle("75:25") +
    scale_fill_viridis(limits = c(min_value, max_value)) +
    theme(axis.text.x = element_text(size = 25),
          axis.title.x = element_text(size = 25),
          axis.text.y = element_text(size = 25), 
          axis.title.y = element_text(size = 25),
          legend.key.height = unit(1, "in"),
          legend.text = element_text(size = 25),
          plot.title = element_text(size = 30),
          panel.background = element_blank(),
          strip.text = element_text(size = 25),
          panel.border = element_rect(colour = "black", fill = NA, size = 1))

  
  # Arrange the plots into grids
  Clust1grid <-annotate_figure(
    ggarrange(a, b, c, ncol = 3, nrow = 1),
    top = text_grob(paste("DMSO -", fill_column), size = 50, face = "bold")
  )
  
  # Save the grids with dynamic file names
  ggsave(Clust1grid, filename = paste0("DMSO_", fill_column, ".png"), width = 30, height = 10)
 
}

```

## Playing with Correlation 
### Correlation without Ratio
```{r}
ForCorr <- ds_pheno_1218 %>% filter(Metadata_Treatment == "DMSO") %>% group_by(Abb_ECM) %>% summarize(Mean_Green = mean(Mean_Green_Norm), Mean_Orange = mean(Mean_Orange_Norm), Mean_Red = mean(Mean_Red_Norm))

ForCorr %>% ggplot(aes(Mean_Green, Mean_Orange, color = Abb_ECM))+
 # facet_grid(rows = vars(Metadata_Stiffness)) + 
  geom_point()+
  ylab("Mean Vimentin Expression")+
  xlab("Mean PXR Expression")+
  theme_prism()+
  geom_smooth(method = "lm", formula = y~x, aes(group = 1))+
  theme(legend.position = "none")

ForCorr %>% ggplot(aes(Mean_Red, Mean_Orange, color = Abb_ECM))+
 # facet_grid(rows = vars(Metadata_Stiffness)) + 
  geom_point()+
  ylab("Mean Vimentin Expression")+
  xlab("Mean Ecad Expression")+
  theme_prism()+
  geom_smooth(method = "lm", formula = y~x, aes(group = 1))+
  theme(legend.position = "none")

ForCorr %>% ggplot(aes(Mean_Red, Mean_Green, color = Abb_ECM))+
 # facet_grid(rows = vars(Metadata_Stiffness)) + 
  geom_point()+
  ylab("Mean PXR Expression")+
  xlab("Mean Ecad Expression")+
  theme_prism()+
  geom_smooth(method = "lm", formula = y~x, aes(group = 1))+
  theme(legend.position = "none")
```


### Cor Results - Just Abb_ECM
PXR and Vim are significantly correlated (p = 0.0002062) cor = 0.5260487 
Vim and Ecad are NOT significantly correlated (p = 0.1659) cor = 0.210131
PXR and Ecad are significantly correlated (1.395e-10) cor = 0.7874379 

```{r}
cor.test(ForCorr$Mean_Green, ForCorr$Mean_Orange)

cor.test(ForCorr$Mean_Red, ForCorr$Mean_Orange)

cor.test(ForCorr$Mean_Green, ForCorr$Mean_Red)
```

### Correlation with Ratio, No Stiffness

```{r}
ForCorrRatio <- ds_pheno_1218 %>% filter(Metadata_Treatment == "DMSO") %>% mutate(Conditions = paste0(Abb_ECM, "_", Metadata_Ratio)) %>% group_by(Conditions) %>% summarize(Mean_Green = mean(Mean_Green_Norm), Mean_Orange = mean(Mean_Orange_Norm), Mean_Red = mean(Mean_Red_Norm))

ForCorrRatio %>% ggplot(aes(Mean_Green, Mean_Orange, color = Conditions))+
 # facet_grid(rows = vars(Metadata_Stiffness)) + 
  geom_point()+
  ylab("Mean Vimentin Expression")+
  xlab("Mean PXR Expression")+
  theme_prism()+
  geom_smooth(method = "lm", formula = y~x, aes(group = 1))+
  theme(legend.position = "none")

ForCorrRatio %>% ggplot(aes(Mean_Red, Mean_Orange, color = Conditions))+
 # facet_grid(rows = vars(Metadata_Stiffness)) + 
  geom_point()+
  ylab("Mean Vimentin Expression")+
  xlab("Mean Ecad Expression")+
  theme_prism()+
  geom_smooth(method = "lm", formula = y~x, aes(group = 1))+
  theme(legend.position = "none")

ForCorrRatio %>% ggplot(aes(Mean_Red, Mean_Green, color = Conditions))+
 # facet_grid(rows = vars(Metadata_Stiffness)) + 
  geom_point()+
  ylab("Mean PXR Expression")+
  xlab("Mean Ecad Expression")+
  theme_prism()+
  geom_smooth(method = "lm", formula = y~x, aes(group = 1))+
  theme(legend.position = "none")
```


### Cor Results - Abb_ECM + Ratio
PXR and Vim are significantly correlated (p = 7.916e-14) cor = 0.6211482  
Vim and Ecad are significantly correlated (p = 7.062e-05) cor = 0.3589461 
PXR and Ecad are significantly correlated (p-value < 2.2e-16) cor = 0.7906376  

```{r}
cor.test(ForCorrRatio$Mean_Green, ForCorrRatio$Mean_Orange)

cor.test(ForCorrRatio$Mean_Red, ForCorrRatio$Mean_Orange)

cor.test(ForCorrRatio$Mean_Green, ForCorrRatio$Mean_Red)
```

### Corr Abb_ECM + Stiffness
```{r}
ForCorrStiff <- ds_pheno_1218 %>% filter(Metadata_Treatment == "DMSO") %>% mutate(Conditions = paste0(Abb_ECM, "_", Metadata_Stiffness)) %>% group_by(Conditions) %>% summarize(Mean_Green = mean(Mean_Green_Norm), Mean_Orange = mean(Mean_Orange_Norm), Mean_Red = mean(Mean_Red_Norm))

ForCorrStiff %>% ggplot(aes(Mean_Green, Mean_Orange, color = Conditions))+
 # facet_grid(rows = vars(Metadata_Stiffness)) + 
  geom_point()+
  ylab("Mean Vimentin Expression")+
  xlab("Mean PXR Expression")+
  theme_prism()+
  geom_smooth(method = "lm", formula = y~x, aes(group = 1))+
  theme(legend.position = "none")

ForCorrStiff %>% ggplot(aes(Mean_Red, Mean_Orange, color = Conditions))+
 # facet_grid(rows = vars(Metadata_Stiffness)) + 
  geom_point()+
  ylab("Mean Vimentin Expression")+
  xlab("Mean Ecad Expression")+
  theme_prism()+
  geom_smooth(method = "lm", formula = y~x, aes(group = 1))+
  theme(legend.position = "none")

ForCorrStiff %>% ggplot(aes(Mean_Red, Mean_Green, color = Conditions))+
 # facet_grid(rows = vars(Metadata_Stiffness)) + 
  geom_point()+
  ylab("Mean PXR Expression")+
  xlab("Mean Ecad Expression")+
  theme_prism()+
  geom_smooth(method = "lm", formula = y~x, aes(group = 1))+
  theme(legend.position = "none")
```

### Cor Results - Abb_ECM + Stiffness
PXR and Vim are significantly correlated (p = 1.026e-07) cor = 0.5258293   
Vim and Ecad are significantly correlated (p = 0.0344) cor = 0.2232744 
PXR and Ecad are significantly correlated (p-value < 2.2e-16) cor = 0.8001456   

```{r}
cor.test(ForCorrStiff$Mean_Green, ForCorrStiff$Mean_Orange)

cor.test(ForCorrStiff$Mean_Red, ForCorrStiff$Mean_Orange)

cor.test(ForCorrStiff$Mean_Green, ForCorrStiff$Mean_Red)
```
## Correlation Plots
### Calculating Survival
```{r}
controlmean_1218 <- ds_pheno_1218 %>% filter(Metadata_Treatment == "DMSO") %>% group_by(Abb_ECM, Metadata_Ratio, Metadata_Stiffness, Metadata_Experiment)

controlmean_1218$ControlMean <- controlmean_1218$Mean_Nuclei

controlmeanfinal <-  dplyr::select(controlmean_1218, Abb_ECM, Metadata_Ratio, Metadata_Stiffness, Metadata_Experiment, ControlMean)

FOC12_18 <- left_join(ds_pheno_1218, controlmeanfinal)

FOC12_18$FOC <- FOC12_18$Mean_Nuclei/FOC12_18$ControlMean

FOC12_18$Condition <- paste(FOC12_18$Abb_ECM, FOC12_18$Metadata_Ratio)

Survival <- FOC12_18[,c("Metadata_Stiffness", "Metadata_Experiment", "Metadata_Treatment", "Condition", "Abb_ECM", "Metadata_Ratio", "ControlMean", "FOC")]

Survival <- subset(Survival, Metadata_Treatment == "10 uM")

Survival <- subset(Survival, select = -c(Metadata_Treatment))

Phenotypes <- FOC12_18[,c("Metadata_Stiffness", "Metadata_Experiment", "Metadata_Treatment", "Condition", "Abb_ECM", "Metadata_Ratio", "Mean_Red_Norm", "Mean_Orange_Norm", "Mean_Green_Norm")]

SurvivalPheno <- left_join(Survival, Phenotypes)

SP1 <- subset(SurvivalPheno, Metadata_Stiffness == "1kPa" & Metadata_Treatment == "DMSO")
SP25 <- subset(SurvivalPheno, Metadata_Stiffness == "25kPa"& Metadata_Treatment == "DMSO")

SP1 <- SP1 %>% select("FOC", "Mean_Orange_Norm", "Mean_Red_Norm", "Mean_Green_Norm")
SP25 <- SP25 %>% select("FOC", "Mean_Orange_Norm", "Mean_Red_Norm", "Mean_Green_Norm")

colnames(SP1) <- c("Survival", "Vimentin", "Ecad", "PXR")
colnames(SP25) <- c("Survival", "Vimentin", "Ecad", "PXR")
```


```{r}
library(corrplot)
library(RColorBrewer)
library(ggcorrplot)

SPcor1 <- cor(SP1)
SPcor25 <- cor(SP25)

testRes1<- cor.mtest(SP1)
testRes25 <- cor.mtest(SP25)

png("SPcor1corr.png", width = 6, height = 6, units = "in", res = 1200)
corrplot(SPcor1, p.mat = testRes1$p, sig.level = 0.05, type = "upper", order = "hclust", col = brewer.pal(n=8, name = "RdYlBu"), diag = FALSE, addCoef.col = 'black', title = "Correlation of Phenotypes and Survival on 1 kPa")
dev.off()

png("SPcor25corr.png", width = 6, height = 6, units = "in", res = 1200)
corrplot(SPcor25, p.mat = testRes25$p, sig.level = 0.05, type = "upper", order = "hclust", col = brewer.pal(n=8, name = "RdYlBu"), diag = FALSE, addCoef.col = 'black', title = "Correlation of Phenotypes and Survival on 25 kPa")
dev.off()

ggcorrplot(SPcor1, method = "circle", hc.order = TRUE, type = "lower", lab = TRUE, ggtheme = theme_bw)
ggsave("SPcor1.png")
ggcorrplot(SPcor25, method = "circle", hc.order = TRUE, type = "lower", lab = TRUE, ggtheme = theme_bw)
ggsave("SPcor25.png")
```

## Specific ECM Callouts Graph
```{r}
ECMPlot <- ds_pheno_1218 %>% mutate(RatioECM1 = case_when(Metadata_Ratio == "100" ~ "100",
                                                          Metadata_Ratio == "75/25" ~ "75",
                                                          Metadata_Ratio == "50/50"~ "50",
                                                          Metadata_Ratio == "25/75"~ "25"),
                                    RatioECM2 = case_when(Metadata_Ratio == "100" ~ "",
                                                          Metadata_Ratio == "75/25" ~ "25",
                                                          Metadata_Ratio == "50/50"~ "50",
                                                          Metadata_Ratio == "25/75"~ "75"))
ECMPlot <- left_join(ECMPlot, ECMSep)

ECMPlot <- ECMPlot %>% mutate(Condition = case_when(Metadata_Ratio == "100" ~ paste0(RatioECM1, ECM1),
                                                    Metadata_Ratio != "100" ~ paste0(RatioECM1, ECM1, "_", RatioECM2, ECM2)))
```

```{r}
ECMPlot <- select(ECMPlot, Metadata_Stiffness, Metadata_Treatment, Condition, Mean_Green_Norm, Mean_Orange_Norm, Mean_Red_Norm)

ECMPlot <- ECMPlot %>% group_by(Metadata_Stiffness, Condition, Metadata_Treatment) %>% summarize(Mean_PXR = mean(Mean_Green_Norm), Mean_Vim = mean(Mean_Orange_Norm), Mean_Ecad = mean(Mean_Red_Norm))
```

```{r}
ECMsforPlot <- c("100LN", "75LN_25G3", "75C1_25C4", "25LN_75DN", "25C4_75G3", "75LN_25OPN", "50C1_50HA", "25OPN_75FN")

ECMPlot <- subset(ECMPlot, Condition %in% ECMsforPlot)
```

Look at Z-score for these... Need to Code that then run
```{r}
ECMsPlot <- ECMPlot %>% mutate(Z_PXR = (Mean_PXR - mean(ECMPlot$Mean_PXR))/sd(ECMPlot$Mean_PXR), 
                                      Z_Vim = (Mean_Vim - mean(ECMPlot$Mean_Vim))/sd(ECMPlot$Mean_Vim), 
                                      Z_Ecad = (Mean_Ecad - mean(ECMPlot$Mean_Ecad))/sd(ECMPlot$Mean_Ecad))
```


```{r}
ECMPlotlong <- pivot_longer(ECMsPlot, cols = -c("Metadata_Stiffness", "Condition", "Metadata_Treatment"), names_to = c(".value", "Channel"), names_sep = "_")

# ECMPlotlongScaled <- ECMPlot %>% mutate(Scaled_Green = )
# ECMPlotlongScaled <- pivot_longer(ECMPlotlongScaled, cols = starts_with("Mean"), names_to = "Channel", values_to = "Mean_Expression")

```

```{r}
channelpal <- c("Vim" = "#E69F00", "Ecad" = "#CC79A7", "PXR" = "#009E73" )

ECMPlotlong %>% filter(Metadata_Treatment == "DMSO") %>% ggplot(aes(x = Z, y = Condition, fill = Channel))+
  geom_col(position = "dodge2")+
  facet_grid(cols = vars(Metadata_Stiffness))+
  theme_prism(base_size = 18)+
  scale_fill_manual(values = channelpal)+
ggtitle("Normalized Expression on Select Microenvironments")+
  theme(strip.text.x = element_text(size = 20))
ggsave("Zscorecomparison.png", width = 10, height = 10)

ECMPlotlong %>% filter(Metadata_Treatment == "DMSO") %>% ggplot(aes(x = Mean, y = Condition, fill = Channel))+
  geom_col(position = "dodge2")+
  facet_grid(cols = vars(Metadata_Stiffness))+
  theme_prism()+
  scale_fill_manual(values = channelpal)+
ggtitle("Mean Expression on Select Microenvironments")
ggsave("Meancomparison.png", width = 10, height = 5)

```

## Plotting Drug vs DMSO 
```{r}
dsewithrep$Metadata_Treatment <- factor(dsewithrep$Metadata_Treatment, levels = c("DMSO", "10 uM"))

dsewithrep %>% select(c("Metadata_Stiffness", "Metadata_Treatment", "Conditions", "Mean_Green_Norm", "Mean_Orange_Norm", "Mean_Red_Norm")) %>% pivot_longer(cols = starts_with("Mean_"), names_to = "Channel", values_to = "Mean_Expression") %>% 
  mutate(Phenotype = case_when(Channel == "Mean_Green_Norm" ~ "PXR", Channel == "Mean_Red_Norm" ~ "Ecad", Channel == "Mean_Orange_Norm" ~"Vimentin"))%>%
  ggplot(aes(x = Metadata_Treatment, y = Mean_Expression ))+
  facet_grid(cols = vars(Phenotype))+
  theme_prism()+
  geom_boxplot()+
  ggtitle("Mean Expression of Channels in Sorafenib Treatment")+
  xlab("Sorafenib Treatment")+
  ylab("Mean Expression (aiu)")+
  stat_compare_means()
ggsave("DrugvDMSObox.png")
```
## Overall PCA

### Need to Add EdU
```{r}
DMSOSurvPhe <- subset(SurvivalPheno, Metadata_Treatment == "DMSO")

DMSOforBigPCA <-  subset(DMSOSurvPhe, select = c("Metadata_Stiffness","Condition", "Mean_Green_Norm", "Mean_Orange_Norm", "Mean_Red_Norm", "ControlMean", "FOC"))

PCAshiny(DMSOforBigPCA)
```

## Anova Comparison

```{r}
ResponsesforComp <- anovaoverview

ResponsesforComp$Terms <- row.names(anovaoverview)

ResponsesforComp <- ResponsesforComp[, c("Terms", "Vim psig", "Ecad psig", "PXR psig")]
```

```{r}
ResponsesforComplong <- pivot_longer(ResponsesforComp, cols = ends_with("sig"),  names_to = "Response", values_to = "Significance")

ResponsesforComplong <- ResponsesforComplong %>% mutate(Value = case_when( Significance == NA ~ 0,
                                                                             Significance == "*" ~ 1,
                                                                             Significance == "**" ~ 2,
                                                                             Significance == "***" ~ 3
))

```

```{r}
ResponsesforComplong$Terms <- gsub("Abb_ECM", "ECM", ResponsesforComplong$Terms)
ResponsesforComplong$Terms <- gsub("Metadata_Stiffness", "Stiffness", ResponsesforComplong$Terms)
ResponsesforComplong$Terms <- gsub("Metadata_Treatment", "Treatment", ResponsesforComplong$Terms)
ResponsesforComplong$Terms <- factor(ResponsesforComplong$Terms, levels = unique(ResponsesforComplong$Terms))

ResponsesforComplong$Response <- gsub("Vim psig", "Vimentin", ResponsesforComplong$Response)
ResponsesforComplong$Response <- gsub("Ecad psig", "Ecad", ResponsesforComplong$Response)
ResponsesforComplong$Response <- gsub("PXR psig", "PXR", ResponsesforComplong$Response)
```

```{r}
ResponsesforComplong %>% ggplot(aes(x = Terms, y = Value, fill = Response))+
  facet_grid(cols = vars(Response))+
  geom_col(position = "dodge", color = "white")+
  theme_prism()+
  coord_flip()+
  scale_fill_manual(values = c("Vimentin" = "#E69F00","Ecad" = "#CC79a7", "PXR" = "#009e73"))+
  ylab("Significance (*s)")+
  # scale_x_discrete(limits = rev)+
  theme(axis.text.y = element_text(size = 10),
        strip.text.x = element_text(size = 30))

ggsave("Respanovacomp.png", width = 10, height = 10, dpi = 1200)
```

### Drug Response

```{r}
DrugResponsesforComp <- anovaoverviewdrug

DrugResponsesforComp$Terms <- row.names(anovaoverviewdrug)

DrugResponsesforComp <- DrugResponsesforComp[, c("Terms", "Vim psig", "Ecad psig", "PXR psig")]
```

```{r}
DrugResponsesforComplong <- pivot_longer(DrugResponsesforComp, cols = ends_with("sig"),  names_to = "Response", values_to = "Significance")

DrugResponsesforComplong <- DrugResponsesforComplong %>% mutate(Value = case_when( Significance == NA ~ 0,
                                                                             Significance == "*" ~ 1,
                                                                             Significance == "**" ~ 2,
                                                                             Significance == "***" ~ 3
))

```

```{r}
DrugResponsesforComplong$Terms <- gsub("Abb_ECM", "ECM", DrugResponsesforComplong$Terms)
DrugResponsesforComplong$Terms <- gsub("Metadata_Stiffness", "Stiffness", DrugResponsesforComplong$Terms)
DrugResponsesforComplong$Terms <- gsub("Metadata_Treatment", "Treatment", DrugResponsesforComplong$Terms)
DrugResponsesforComplong$Terms <- factor(DrugResponsesforComplong$Terms, levels = unique(DrugResponsesforComp$Terms))

DrugResponsesforComplong$Response <- gsub("Vim psig", "Vimentin", DrugResponsesforComplong$Response)
DrugResponsesforComplong$Response <- gsub("Ecad psig", "Ecad", DrugResponsesforComplong$Response)
DrugResponsesforComplong$Response <- gsub("PXR psig", "PXR", DrugResponsesforComplong$Response)
```

```{r}
DrugResponsesforComplong %>% ggplot(aes(x = Terms, y = Value, fill = Response))+
  facet_grid(cols = vars(Response))+
  geom_col(position = "dodge", color = "white")+
  theme_prism()+
  coord_flip()+
  scale_fill_manual(values = c("Vimentin" = "#E69F00","Ecad" = "#CC79a7", "PXR" = "#009e73"))+
  ylab("Significance (*s)")+
  # scale_x_discrete(limits = rev)+
  theme(axis.text.y = element_text(size = 10),
        strip.text.x = element_text(size = 30))

ggsave("DrugRespanovacomp.png", width = 15, height = 10, dpi = 1200)
```